from django import forms
from .models import Cargo, Order, Customer, Product, ProductOwner
from django.contrib.auth.models import User


class CheckoutForm(forms.ModelForm):
    class Meta:
        model = Order
        fields = ["ordered_by", "shipping_address", "mobile", "email", "payment_method"]


class CustomerRegistrationForm(forms.ModelForm):
    username = forms.CharField(widget=forms.TextInput())
    password = forms.CharField(widget=forms.PasswordInput())
    email = forms.CharField(widget=forms.EmailInput())

    class Meta:
        model = Customer
        fields = [
            "username",
            "password",
            "full_name",
            "county",
            "town",
            "email",
            "address",
        ]

    def clean_username(self):
        uname = self.cleaned_data.get("username")
        if User.objects.filter(username=uname).exists():
            raise forms.ValidationError("Customer with this username already exists.")

        return uname


class productOwnerRegistrationForm(forms.ModelForm):
    username = forms.CharField(widget=forms.TextInput())
    password = forms.CharField(widget=forms.PasswordInput())
    email = forms.CharField(widget=forms.EmailInput())

    class Meta:
        model = ProductOwner
        fields = ["username", "password", "email", "full_name", "mobile"]

    def clean_username(self):
        uname = self.cleaned_data.get("username")
        if User.objects.filter(username=uname).exists():
            raise forms.ValidationError(
                "ProductOwner with this username already exists."
            )

        return uname


class CustomerLoginForm(forms.Form):
    username = forms.CharField(widget=forms.TextInput())
    password = forms.CharField(widget=forms.PasswordInput())


class ProductForm(forms.ModelForm):
    more_images = forms.FileField(
        required=False,
        widget=forms.FileInput(attrs={"class": "form-control", "multiple": True}),
    )

    class Meta:
        model = Product
        fields = [
            "title",
            "slug",
            "productowner",
            "category",
            "image",
            "county",
            "town",
            "marked_price",
            "selling_price",
            "description",
            "warranty",
            "return_policy",
        ]
        widgets = {
            "title": forms.TextInput(
                attrs={
                    "class": "form-control",
                    "placeholder": "Enter the product title here...",
                }
            ),
            "slug": forms.TextInput(
                attrs={
                    "class": "form-control",
                    "placeholder": "Enter the unique slug here...",
                }
            ),
            "productowner": forms.TextInput(
                attrs={
                    "class": "form-control",
                    "placeholder": "Enter the productowner Phone here...",
                }
            ),
            "category": forms.Select(attrs={"class": "form-control"}),
            "image": forms.ClearableFileInput(attrs={"class": "form-control"}),
            "county": forms.TextInput(
                attrs={
                    "class": "form-control",
                    "placeholder": "Enter product country here...",
                }
            ),
            "town": forms.TextInput(
                attrs={
                    "class": "form-control",
                    "placeholder": "Enter product city here...",
                }
            ),
            "marked_price": forms.NumberInput(
                attrs={
                    "class": "form-control",
                    "placeholder": "Marked price of the product...",
                }
            ),
            "selling_price": forms.NumberInput(
                attrs={
                    "class": "form-control",
                    "placeholder": "Selling price of the product...",
                }
            ),
            "description": forms.Textarea(
                attrs={
                    "class": "form-control",
                    "placeholder": "Description of the product...",
                    "rows": 5,
                }
            ),
            "warranty": forms.TextInput(
                attrs={
                    "class": "form-control",
                    "placeholder": "Enter the product warranty here...",
                }
            ),
            "return_policy": forms.TextInput(
                attrs={
                    "class": "form-control",
                    "placeholder": "Enter the product return policy here...",
                }
            ),
        }


class CargoForm(forms.ModelForm):
    more_images = forms.FileField(
        required=False,
        widget=forms.FileInput(attrs={"class": "form-control", "multiple": True}),
    )

    class Meta:
        model = Cargo
        fields = [
            "CampanyName",
            "driverName",
            "address",
            "image",
            "price",
            "cargo_status",
        ]
        widgets = {
            "CampanyName": forms.Select(
                attrs={
                    "class": "form-control",
                    "placeholder": "Enter the Company name here...",
                }
            ),
            "DriverName": forms.TextInput(
                attrs={
                    "class": "form-control",
                    "placeholder": "Enter the Driver name here...",
                }
            ),
            "cargo_status": forms.Select(attrs={"class": "form-control"}),
            "address": forms.TextInput(
                attrs={
                    "class": "form-control",
                    "placeholder": "Enter the your address eg: kk 310st...",
                }
            ),
            "category": forms.Select(attrs={"class": "form-control"}),
            "image": forms.ClearableFileInput(attrs={"class": "form-control"}),
            "price": forms.NumberInput(
                attrs={
                    "class": "form-control",
                    "placeholder": "Marked price of the product...",
                }
            ),
        }


class PasswordForgotForm(forms.Form):
    email = forms.CharField(
        widget=forms.EmailInput(
            attrs={
                "class": "form-control",
                "placeholder": "Enter the email used in customer account...",
            }
        )
    )

    def clean_email(self):
        e = self.cleaned_data.get("email")
        if not Customer.objects.filter(user__email=e).exists():
            raise forms.ValidationError("Customer with this account does not exists..")
        return e


class PasswordResetForm(forms.Form):
    new_password = forms.CharField(
        widget=forms.PasswordInput(
            attrs={
                "class": "form-control",
                "autocomplete": "new-password",
                "placeholder": "Enter New Password",
            }
        ),
        label="New Password",
    )
    confirm_new_password = forms.CharField(
        widget=forms.PasswordInput(
            attrs={
                "class": "form-control",
                "autocomplete": "new-password",
                "placeholder": "Confirm New Password",
            }
        ),
        label="Confirm New Password",
    )

    def clean_confirm_new_password(self):
        new_password = self.cleaned_data.get("new_password")
        confirm_new_password = self.cleaned_data.get("confirm_new_password")
        if new_password != confirm_new_password:
            raise forms.ValidationError("New Passwords did not match!")
        return confirm_new_password


# map
from django.forms import ModelForm
from django.contrib.auth.forms import UserCreationForm, AuthenticationForm
from django.contrib.auth.models import User
from django import forms
from .models import Admin


class UserForm(UserCreationForm):
    """
    Form that uses built-in UserCreationForm to handel user creation
    """

    first_name = forms.CharField(
        max_length=30,
        required=True,
        widget=forms.TextInput(attrs={"placeholder": "*Your first name.."}),
    )
    last_name = forms.CharField(
        max_length=30,
        required=True,
        widget=forms.TextInput(attrs={"placeholder": "*Your last name.."}),
    )
    username = forms.EmailField(
        max_length=254,
        required=True,
        widget=forms.TextInput(attrs={"placeholder": "*Email.."}),
    )
    password1 = forms.CharField(
        widget=forms.PasswordInput(
            attrs={"placeholder": "*Password..", "class": "password"}
        )
    )
    password2 = forms.CharField(
        widget=forms.PasswordInput(
            attrs={"placeholder": "*Confirm Password..", "class": "password"}
        )
    )

    # reCAPTCHA token
    token = forms.CharField(widget=forms.HiddenInput())

    class Meta:
        model = User
        fields = (
            "username",
            "first_name",
            "last_name",
            "password1",
            "password2",
        )


class AuthForm(AuthenticationForm):
    """
    Form that uses built-in AuthenticationForm to handel user auth
    """

    username = forms.EmailField(
        max_length=254,
        required=True,
        widget=forms.TextInput(attrs={"placeholder": "*Email.."}),
    )
    password = forms.CharField(
        widget=forms.PasswordInput(
            attrs={"placeholder": "*Password..", "class": "password"}
        )
    )

    class Meta:
        model = User
        fields = (
            "username",
            "password",
        )


class UserProfileForm(forms.ModelForm):
    """
    Basic model-form for our user profile that extends Django user model.

    """

    address = forms.CharField(max_length=100, required=True, widget=forms.HiddenInput())
    town = forms.CharField(max_length=100, required=True, widget=forms.HiddenInput())
    county = forms.CharField(max_length=100, required=True, widget=forms.HiddenInput())
    post_code = forms.CharField(max_length=8, required=True, widget=forms.HiddenInput())
    country = forms.CharField(max_length=40, required=True, widget=forms.HiddenInput())
    longitude = forms.CharField(
        max_length=50, required=True, widget=forms.HiddenInput()
    )
    latitude = forms.CharField(max_length=50, required=True, widget=forms.HiddenInput())

    class Meta:
        model = Admin
        fields = (
            "address",
            "town",
            "county",
            "post_code",
            "country",
            "longitude",
            "latitude",
        )
